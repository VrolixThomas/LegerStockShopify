<div class="product-list-wrapper">
  <h2>{{ section.settings.title }}</h2>

  {%- comment -%} Filtering {%- endcomment -%}
  <div class="filters">
    <div class="filter-group">
      <label>Material:</label>
      <select id="filter-material" onchange="filterProducts()">
        <option value="">All Materials</option>
        <option value="aluminium">Aluminium</option>
        <option value="iron">Iron</option>
        <option value="inox">Inox</option>
        <option value="steel">Steel</option>
        <option value="copper">Copper</option>
        <option value="brass">Brass</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Form:</label>
      <select id="filter-form" onchange="filterProducts()">
        <option value="">All Forms</option>
        <option value="tube">Tube</option>
        <option value="l-shape">L-Shape</option>
        <option value="t-shape">T-Shape</option>
        <option value="flat">Flat Sheet</option>
        <option value="round">Round Bar</option>
        <option value="square">Square Bar</option>
      </select>
    </div>

    <button onclick="clearFilters()" class="clear-filters">Clear Filters</button>
  </div>

  <div class="products-list-container">
    <div class="products-list-header">
      <div class="col-product">Product</div>
      <div class="col-material">Material</div>
      <div class="col-form">Form</div>
      <div class="col-dimension">Dimension</div>
      <div class="col-price">Price</div>
      <div class="col-quantity">Quantity</div>
      <div class="col-action">Action</div>
    </div>

    <div class="products-list" id="product-list">
      {% if section.settings.collection != blank %}
        {% for product in section.settings.collection.products limit: section.settings.products_to_show %}
          {% render 'product-card-metal', product: product %}
        {% endfor %}
      {% else %}
        {% for product in collections.all.products limit: section.settings.products_to_show %}
          {% render 'product-card-metal', product: product %}
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

<script>
  function filterProducts() {
    const materialFilter = document.getElementById('filter-material').value.toLowerCase();
    const formFilter = document.getElementById('filter-form').value.toLowerCase();
    const products = document.querySelectorAll('.product-row');

    console.log('Filtering:', { materialFilter, formFilter, totalProducts: products.length });

    let visibleCount = 0;
    products.forEach((product, index) => {
      const material = (product.dataset.material || '').toLowerCase().trim();
      const form = (product.dataset.form || '').toLowerCase().trim();

      if (index < 3) {
        console.log(`Product ${index}:`, { material, form, dataset: product.dataset });
      }

      const materialMatch = !materialFilter || material === materialFilter;
      const formMatch = !formFilter || form === formFilter;

      if (materialMatch && formMatch) {
        product.style.display = 'grid';
        visibleCount++;
      } else {
        product.style.display = 'none';
      }
    });

    console.log('Visible products:', visibleCount);
  }

  function clearFilters() {
    document.getElementById('filter-material').value = '';
    document.getElementById('filter-form').value = '';
    filterProducts();
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Page loaded, checking products...');
    const products = document.querySelectorAll('.product-row');
    console.log('Total product rows found:', products.length);
    if (products.length > 0) {
      console.log('First product data:', products[0].dataset);
    }
  });
</script>

{% stylesheet %}
  .product-list-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 40px 20px;
  }

  .product-list-wrapper h2 {
    margin-bottom: 30px;
    font-size: 28px;
  }

  .filters {
    background: #f8f8f8;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
    display: flex;
    gap: 20px;
    align-items: flex-end;
    flex-wrap: wrap;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .filter-group label {
    font-weight: 600;
    font-size: 14px;
  }

  .filter-group select {
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    background: white;
    min-width: 180px;
  }

  .clear-filters {
    padding: 10px 20px;
    background: #000;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }

  .clear-filters:hover {
    background: #333;
  }

  .products-list-container {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
  }

  .products-list-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1.5fr 1fr 1.2fr 1.2fr;
    gap: 16px;
    padding: 16px 20px;
    background: #f5f5f5;
    font-weight: 600;
    font-size: 14px;
    border-bottom: 2px solid #ddd;
  }

  .products-list {
    display: flex;
    flex-direction: column;
  }

  @media (max-width: 1024px) {
    .products-list-header {
      display: none;
    }
  }

  @media (max-width: 768px) {
    .filters {
      flex-direction: column;
      align-items: stretch;
    }

    .filter-group select {
      min-width: 100%;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Metal Products List",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Metal Products Catalog"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 2,
      "max": 100,
      "step": 1,
      "default": 50
    }
  ],
  "presets": [
    {
      "name": "Metal Products List"
    }
  ]
}
{% endschema %}
